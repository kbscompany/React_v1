# Commands to run on EC2 to fix the BOM issue

echo "Run these commands on your EC2 server:"
echo ""
echo "# 1. First, check which files have BOM:"
echo "cd /home/ec2-user/React_v1"
echo "file *.py | grep -i bom"
echo "file .env | grep -i bom"
echo ""
echo "# 2. Check the first few bytes of .env file:"
echo "od -c .env | head -n 2"
echo ""
echo "# 3. Remove BOM from ALL Python files and .env:"
echo "for file in *.py .env; do"
echo "  if [ -f \"\$file\" ]; then"
echo "    sed -i '1s/^\xEF\xBB\xBF//' \"\$file\""
echo "    echo \"Cleaned: \$file\""
echo "  fi"
echo "done"
echo ""
echo "# 4. Also check config.py specifically:"
echo "hexdump -C config.py | head -n 1"
echo ""
echo "# 5. If the above doesn't work, try recreating .env:"
echo "mv .env .env.old"
echo "cat > .env << 'EOF'"
echo "DB_HOST=localhost"
echo "DB_PORT=3306"
echo "DB_USER=root"
echo "DB_PASSWORD=Kbs@2024\$"
echo "DB_NAME=bakery_react"
echo "SECRET_KEY=production-secret-key-minimum-32-characters-long-for-jwt-tokens-ec2"
echo "ACCESS_TOKEN_EXPIRE_MINUTES=30"
echo "ENVIRONMENT=production"
echo "DEBUG=false"
echo "LOG_LEVEL=INFO"
echo "ALLOWED_ORIGINS=http://100.29.4.72:3000,http://100.29.4.72:8000,http://localhost:3000"
echo "MAX_UPLOAD_SIZE_MB=10"
echo "ALLOWED_FILE_EXTENSIONS=pdf,jpg,jpeg,png,doc,docx,xls,xlsx"
echo "ADMIN_PASSWORD=admin123"
echo "EOF"
echo ""
echo "# 6. Restart the service:"
echo "sudo systemctl restart fastapi.service"
echo "sudo systemctl status fastapi.service"
echo ""
echo "# 7. Check the logs for more details:"
echo "sudo journalctl -u fastapi.service -n 50 --no-pager"
