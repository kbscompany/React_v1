#!/bin/bash
# Script to fix the BOM character issue in .env file on EC2

echo "=== Fixing .env file BOM issue on EC2 ==="
echo ""
echo "Run these commands on your EC2 server:"
echo ""
echo "# 1. Check for BOM characters in .env file"
echo "cd /home/ec2-user/React_v1"
echo "hexdump -C .env | head -n 5"
echo ""
echo "# 2. If you see 'ef bb bf' at the beginning, remove the BOM:"
echo "sed -i '1s/^\xEF\xBB\xBF//' .env"
echo ""
echo "# 3. Alternative: Create a clean .env file"
echo "cp .env .env.backup"
echo "cat .env.backup | sed '1s/^\xEF\xBB\xBF//' > .env"
echo ""
echo "# 4. Verify the fix"
echo "head -n 1 .env | od -c"
echo ""
echo "# 5. Restart the service"
echo "sudo systemctl restart fastapi.service"
echo "sudo systemctl status fastapi.service"
echo ""
echo "# 6. If it still fails, check the Python files for BOM:"
echo "file *.py | grep BOM"
echo ""
echo "# 7. If config.py has BOM, fix it:"
echo "sed -i '1s/^\xEF\xBB\xBF//' config.py"
echo ""
echo "# 8. Deploy the updated simple_routes.py file"
echo "# First, backup the current file"
echo "cp routers/simple_routes.py routers/simple_routes.py.backup"
echo ""
echo "# Then copy the updated file from your local machine"
echo "# On your local machine, run:"
echo "scp routers/simple_routes.py ec2-user@100.29.4.72:/home/ec2-user/React_v1/routers/"
